---
layout:        post
title:         "Flask Web | Flask 的扩展"
subtitle:      "举例说明 Flask 生态中常见的几种扩展"
author:        "Haauleon"
header-img:    "img/in-post/post-flask/bg.jpeg"
header-mask:   0.4
catalog:       true
tags:
    - Flask
    - Python
    - Web开发
    - Vagrant
    - Ubuntu
---

> 本篇所有操作均在基于 Ubuntu 16.04 LTS 的虚拟机下完成，且使用 Vagrant 来操作虚拟机系统，虚拟机系统 VirtualBox Version: 7.0 

<br>
<br>

### 一、Flask 的扩展
环境准备：     
Python 2.7.11+      
pip==9.0.3     
flask==0.11.1   
httpie==0.9.4     
werkzeug==0.11.10       

&emsp;&emsp;Flask 扩展的生态非常繁荣，这里介绍其中最常用的扩展。    

<br>

#### 1、Flask-Script
&emsp;&emsp;Django 提供了如下管理命令：    
```
> python manage.py startapp
> python manage.py runserver
```

&emsp;&emsp;Flask 也可以通过 Flask-Script 添加运行服务器、设置数据库、定制 shell 等功能的命令。但如果已经使用了 Flask 0.11 版本，可以考虑使用 Flask 自带的命令行接口替代它。      

&emsp;&emsp;使用以下命令行安装 Flask-Script：    
```
> pip2 install flask-script
```

&emsp;&emsp;安装完成后在需要管理的项目根目录下创建一个 manage.py 文件并写入以下内容后保存，即可使用 manage.py 来管理项目：      
```python
# coding=utf-8
"""
在很多地方可能都会看到 from flask.ext.package import X 的用法，但这种用法已经收到了官方反对。
要采用 from flask_script import X 的方式。
"""
from flask_script import Manager, Server, Shell, prompt_bool

from app import app, db, PasteFile

manager = Manager(app)


def make_shell_context():
    return {
        'db': db,
        'PasteFile': PasteFile,
        'app': app
    }


@manager.command
def dropdb():
    if prompt_bool(
            'Are you sure you want to lose all your data'):
        db.drop_all()


@manager.option('-h', '--filehash', dest='filehash')
def get_file(filehash):
    paste_file = PasteFile.query.filter_by(filehash=filehash).first()
    if not paste_file:
        print 'Not exists'
    else:
        print 'URL is {}'.format(paste_file.get_url('i'))


manager.add_command('shell', Shell(make_context=make_shell_context))
manager.add_command('runserver', Server(
    use_debugger=True, use_reloader=True,
    host='0.0.0.0', port=9000)
)


if __name__ == '__main__':
    manager.run()
```

<br>

现在可以使用 manage.py 来管理项目了，输入以下命令行来管理：    
1. 在终端通过 filehash 获取文件路径      
    ```
    (venv) ❯ python2 manage.py get_file -h 8583d66b6b2e467e8c6b586ca428db74.jpg
    URL is http://localhost/i/8583d66b6b2e467e8c6b586ca428db74.jpg

    (venv) ❯ python2 manage.py get_file -h 8583d66b6b2e467e8c6b586ca4hgnnfk.jpg
    Not exists
    ```
2. 在测试环境中可以用来清理数据    
    ```
    (venv) ❯ python2 manage.py dropdb
    Are you sure you want to lose all your data [n]: n
    ```
3. 自带了三个内置变量的 shell     
    ```
    (venv) ❯ python2 manage.py shell

    In [1]: db
    Out[1]: <SQLAlchemy engine='mysql://web:web@localhost:3306/r'>

    In [2]: PasteFile
    Out[2]: models.PasteFile
    ```
4. 通过 manage.py 启动服务    
    ```
    (venv) ❯ python2 manage.py runserver
    * Running on http://0.0.0.0:9000/ (Press CTRL+C to quit)
    * Restarting with stat
    * Debugger is active!
    * Debugger pin code: 203-908-357
    10.0.2.2 - - [21/Dec/2022 06:16:30] "GET / HTTP/1.1" 200 -
    10.0.2.2 - - [21/Dec/2022 06:16:38] "GET / HTTP/1.1" 200 -
    10.0.2.2 - - [21/Dec/2022 06:16:39] "GET / HTTP/1.1" 200 -
    10.0.2.2 - - [21/Dec/2022 06:16:40] "GET / HTTP/1.1" 200 -
    10.0.2.2 - - [21/Dec/2022 06:17:21] "POST / HTTP/1.1" 200 -
    10.0.2.2 - - [21/Dec/2022 06:17:21] "GET /i/dae3aa929d0b4fb4a00d5758cecce502.jpg HTTP/1.1" 200 -
    10.0.2.2 - - [21/Dec/2022 06:20:19] "GET /i/dae3aa929d0b4fb4a00d5758cecce502.jpg HTTP/1.1" 304 -
    ```

&emsp;&emsp;


<br>
<br>

#### 2、Flask-DebugToolbar
&emsp;&emsp;Django 有非常知名的 Django-DebugToolbar，而 Flask 也有对应的替代工具 Flask-DebugToolbar。它会在浏览器上添加右边栏，可以快速查看环境变量、上下文内容，方便调试。     

&emsp;&emsp;使用以下命令行安装 Flask-Script：    
```
> pip2 install flask-debugtoolbar
```

&emsp;&emsp;使用它也很简单，但是注意 app.debug 要为 True 才可以看到调试边栏。如下使用示例：    
```python
# coding=utf-8
from flask import Flask
from flask_debugtoolbar import DebugToolbarExtension

app = Flask(__name__)

app.debug = True

app.config['SECRET_KEY'] = 'a secret key'

toolbar = DebugToolbarExtension(app)


@app.route('/')
def hello():
    return '<body></body>'


if __name__ == '__main__':
    app.run(host='0.0.0.0', port=9000, debug=app.debug)
```

浏览器右边栏显示如下图：   
[](\img\in-post\post-flask\2022-12-20-flask-ext-1.jpg)   

<br>
<br>

#### 3、Flask-Migrate


<br>
<br>

#### 4、Flask-WTF


<br>
<br>

#### 5、Flask-Security


<br>
<br>

#### 6、Flask-RESTful


<br>
<br>

#### 7、Flask-Admin


<br>
<br>

#### 8、Flask-Assets